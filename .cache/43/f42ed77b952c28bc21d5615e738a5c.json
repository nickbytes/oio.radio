{"id":"zM1z","dependencies":[{"name":"/Users/m/www/oio/land/oio.radio/package.json","includedInParent":true,"mtime":1585257763511},{"name":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/package.json","includedInParent":true,"mtime":1585257763157},{"name":"assert-plus","loc":{"line":3,"column":21},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/www/oio/land/oio.radio/node_modules/assert-plus/assert.js"},{"name":"crypto","loc":{"line":4,"column":21},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/.config/yarn/global/node_modules/crypto-browserify/index.js"},{"name":"http","loc":{"line":5,"column":19},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/.config/yarn/global/node_modules/stream-http/index.js"},{"name":"util","loc":{"line":11,"column":22},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/.config/yarn/global/node_modules/util/util.js"},{"name":"sshpk","loc":{"line":7,"column":20},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/www/oio/land/oio.radio/node_modules/sshpk/lib/index.js"},{"name":"jsprim","loc":{"line":8,"column":21},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/www/oio/land/oio.radio/node_modules/jsprim/lib/jsprim.js"},{"name":"./utils","loc":{"line":9,"column":20},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/utils.js"},{"name":"buffer","parent":"/Users/m/www/oio/land/oio.radio/node_modules/http-signature/lib/signer.js","resolved":"/Users/m/.config/yarn/global/node_modules/buffer/index.js"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar e=require(\"buffer\").Buffer,t=require(\"assert-plus\"),r=require(\"crypto\"),i=require(\"http\"),s=require(\"util\"),o=require(\"sshpk\"),n=require(\"jsprim\"),a=require(\"./utils\"),h=require(\"util\").format,g=a.HASH_ALGOS,p=a.PK_ALGOS,u=a.InvalidAlgorithmError,y=a.HttpSignatureError,d=a.validateAlgorithm,l='Signature keyId=\"%s\",algorithm=\"%s\",headers=\"%s\",signature=\"%s\"';function f(e){y.call(this,e,f)}function c(e){y.call(this,e,c)}function k(i){t.object(i,\"options\");var s=[];if(void 0!==i.algorithm&&(t.string(i.algorithm,\"options.algorithm\"),s=d(i.algorithm)),this.rs_alg=s,void 0!==i.sign)t.func(i.sign,\"options.sign\"),this.rs_signFunc=i.sign;else if(\"hmac\"===s[0]&&void 0!==i.key){if(t.string(i.keyId,\"options.keyId\"),this.rs_keyId=i.keyId,\"string\"!=typeof i.key&&!e.isBuffer(i.key))throw new TypeError(\"options.key for HMAC must be a string or Buffer\");this.rs_signer=r.createHmac(s[1].toUpperCase(),i.key),this.rs_signer.sign=function(){var e=this.digest(\"base64\");return{hashAlgorithm:s[1],toString:function(){return e}}}}else{if(void 0===i.key)throw new TypeError(\"options.sign (func) or options.key is required\");var n=i.key;if((\"string\"==typeof n||e.isBuffer(n))&&(n=o.parsePrivateKey(n)),t.ok(o.PrivateKey.isPrivateKey(n,[1,2]),\"options.key must be a sshpk.PrivateKey\"),this.rs_key=n,t.string(i.keyId,\"options.keyId\"),this.rs_keyId=i.keyId,!p[n.type])throw new u(n.type.toUpperCase()+\" type keys are not supported\");if(void 0!==s[0]&&n.type!==s[0])throw new u(\"options.key must be a \"+s[0].toUpperCase()+\" key, was given a \"+n.type.toUpperCase()+\" key instead\");this.rs_signer=n.createSign(s[1])}this.rs_headers=[],this.rs_lines=[]}s.inherits(f,y),s.inherits(c,y),k.prototype.writeHeader=function(e,r){if(t.string(e,\"header\"),e=e.toLowerCase(),t.string(r,\"value\"),this.rs_headers.push(e),this.rs_signFunc)this.rs_lines.push(e+\": \"+r);else{var i=e+\": \"+r;this.rs_headers.length>0&&(i=\"\\n\"+i),this.rs_signer.update(i)}return r},k.prototype.writeDateHeader=function(){return this.writeHeader(\"date\",n.rfc1123(new Date))},k.prototype.writeTarget=function(e,r){t.string(e,\"method\"),t.string(r,\"path\"),e=e.toLowerCase(),this.writeHeader(\"(request-target)\",e+\" \"+r)},k.prototype.sign=function(e){if(t.func(e,\"callback\"),this.rs_headers.length<1)throw new Error(\"At least one header must be signed\");var r,i;if(this.rs_signFunc){var s=this.rs_lines.join(\"\\n\"),o=this;this.rs_signFunc(s,function(s,n){if(s)e(s);else{try{t.object(n,\"signature\"),t.string(n.keyId,\"signature.keyId\"),t.string(n.algorithm,\"signature.algorithm\"),t.string(n.signature,\"signature.signature\"),r=d(n.algorithm),i=h(l,n.keyId,n.algorithm,o.rs_headers.join(\" \"),n.signature)}catch(a){return void e(a)}e(null,i)}})}else{try{var n=this.rs_signer.sign()}catch(g){return void e(g)}r=(this.rs_alg[0]||this.rs_key.type)+\"-\"+n.hashAlgorithm;var a=n.toString();i=h(l,this.rs_keyId,r,this.rs_headers.join(\" \"),a),e(null,i)}},module.exports={isSigner:function(e){return\"object\"==typeof e&&e instanceof k},createSigner:function(e){return new k(e)},signRequest:function(i,s){t.object(i,\"request\"),t.object(s,\"options\"),t.optionalString(s.algorithm,\"options.algorithm\"),t.string(s.keyId,\"options.keyId\"),t.optionalArrayOfString(s.headers,\"options.headers\"),t.optionalString(s.httpVersion,\"options.httpVersion\"),i.getHeader(\"Date\")||i.setHeader(\"Date\",n.rfc1123(new Date)),s.headers||(s.headers=[\"date\"]),s.httpVersion||(s.httpVersion=\"1.1\");var a,y=[];s.algorithm&&(s.algorithm=s.algorithm.toLowerCase(),y=d(s.algorithm));var k,m=\"\";for(a=0;a<s.headers.length;a++){if(\"string\"!=typeof s.headers[a])throw new TypeError(\"options.headers must be an array of Strings\");var w=s.headers[a].toLowerCase();if(\"request-line\"===w){if(s.strict)throw new c(\"request-line is not a valid header with strict parsing enabled.\");m+=i.method+\" \"+i.path+\" HTTP/\"+s.httpVersion}else if(\"(request-target)\"===w)m+=\"(request-target): \"+i.method.toLowerCase()+\" \"+i.path;else{var v=i.getHeader(w);if(void 0===v||\"\"===v)throw new f(w+\" was not in the request\");m+=w+\": \"+v}a+1<s.headers.length&&(m+=\"\\n\")}if(i.hasOwnProperty(\"_stringToSign\")&&(i._stringToSign=m),\"hmac\"===y[0]){if(\"string\"!=typeof s.key&&!e.isBuffer(s.key))throw new TypeError(\"options.key must be a string or Buffer\");var _=r.createHmac(y[1].toUpperCase(),s.key);_.update(m),k=_.digest(\"base64\")}else{var q=s.key;if((\"string\"==typeof q||e.isBuffer(q))&&(q=o.parsePrivateKey(s.key)),t.ok(o.PrivateKey.isPrivateKey(q,[1,2]),\"options.key must be a sshpk.PrivateKey\"),!p[q.type])throw new u(q.type.toUpperCase()+\" type keys are not supported\");if(void 0!==y[0]&&q.type!==y[0])throw new u(\"options.key must be a \"+y[0].toUpperCase()+\" key, was given a \"+q.type.toUpperCase()+\" key instead\");var S=q.createSign(y[1]);S.update(m);var b=S.sign();if(!g[b.hashAlgorithm])throw new u(b.hashAlgorithm.toUpperCase()+\" is not a supported hash algorithm\");s.algorithm=q.type+\"-\"+b.hashAlgorithm,k=b.toString(),t.notStrictEqual(k,\"\",\"empty signature produced\")}var I=s.authorizationHeaderName||\"Authorization\";return i.setHeader(I,h(l,s.keyId,s.algorithm,s.headers.join(\" \"),k)),!0}};"},"sourceMaps":null,"error":null,"hash":"f8d3e70be409e4132683087b4efd5acd","cacheData":{"env":{}}}